<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Nexus Science</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --text: #0f172a; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .admin-container { max-width: 500px; margin: 0 auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { color: var(--primary); margin-top: 0; font-size: 1.2rem; }
        input, textarea, select { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #e2e8f0; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; margin-top: 10px; }
        
        .news-item { background: #f1f5f9; padding: 15px; border-radius: 10px; margin-top: 15px; position: relative; }
        .news-item h4 { margin: 0 0 10px 0; font-size: 0.9rem; }
        .action-btns { display: flex; gap: 10px; margin-top: 10px; }
        .edit-btn { background: #10b981; flex: 1; padding: 8px; font-size: 0.8rem; }
        .delete-btn { background: #ef4444; flex: 1; padding: 8px; font-size: 0.8rem; }
    </style>
</head>
<body>

<div class="admin-container">
    <h2>Post Science Update</h2>
    <input type="hidden" id="editId">
    <input type="text" id="title" placeholder="News Headline">
    <select id="category">
        <option value="Biology">Biology</option>
        <option value="Space">Space</option>
        <option value="Physics">Physics</option>
        <option value="Tech">Tech</option>
    </select>
    <textarea id="summary" placeholder="Summary (Short English)" rows="4"></textarea>
    <input type="text" id="imageUrl" placeholder="Image URL">
    <input type="text" id="source" placeholder="Source Website Link">
    <button id="submitBtn" onclick="saveNews()">Publish News</button>

    <hr style="margin: 25px 0; border: 0; border-top: 1px solid #e2e8f0;">
    <h2>Recent Posts</h2>
    <div id="admin-list">Loading posts...</div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
    import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAVP5U2HK4B5bqR_q-IAP5fveEkAsXbY8g",
        authDomain: "nexus-science-41e41.firebaseapp.com",
        projectId: "nexus-science-41e41",
        storageBucket: "nexus-science-41e41.firebasestorage.app",
        messagingSenderId: "451271613286",
        appId: "1:451271613286:web:4a1a16777d4298334a86a7"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const adminList = document.getElementById('admin-list');

    // Load News for Admin
    onSnapshot(query(collection(db, "news"), orderBy("timestamp", "desc")), (snapshot) => {
        adminList.innerHTML = '';
        snapshot.forEach((post) => {
            const data = post.data();
            const div = document.createElement('div');
            div.className = 'news-item';
            div.innerHTML = `
                <h4>${data.title}</h4>
                <div class="action-btns">
                    <button class="edit-btn" onclick="prepareEdit('${post.id}', \`${data.title.replace(/`/g, "'")}\`, '${data.category}', \`${data.summary.replace(/`/g, "'")}\`, '${data.imageUrl}', '${data.source}')">Edit</button>
                    <button class="delete-btn" onclick="deleteNews('${post.id}')">Delete</button>
                </div>
            `;
            adminList.appendChild(div);
        });
    });

    const checkPass = () => prompt("Enter Admin Password:") === "mousom2026";

    window.saveNews = async function() {
        if(!checkPass()) return alert("Access Denied!");
        
        const id = document.getElementById('editId').value;
        const payload = {
            title: document.getElementById('title').value,
            category: document.getElementById('category').value,
            summary: document.getElementById('summary').value,
            imageUrl: document.getElementById('imageUrl').value,
            source: document.getElementById('source').value,
            timestamp: serverTimestamp()
        };

        try {
            if(id) {
                await updateDoc(doc(db, "news", id), payload);
                alert("Updated Successfully!");
            } else {
                await addDoc(collection(db, "news"), payload);
                alert("Published Successfully!");
            }
            location.reload();
        } catch (e) { alert("Error: " + e.message); }
    };

    window.prepareEdit = function(id, title, cat, sum, img, src) {
        document.getElementById('editId').value = id;
        document.getElementById('title').value = title;
        document.getElementById('category').value = cat;
        document.getElementById('summary').value = sum;
        document.getElementById('imageUrl').value = img;
        document.getElementById('source').value = src;
        document.getElementById('submitBtn').innerText = "Update News";
        window.scrollTo(0,0);
    };

    window.deleteNews = async function(id) {
        if(!checkPass()) return alert("Access Denied!");
        if(confirm("Are you sure you want to delete this news?")) {
            await deleteDoc(doc(db, "news", id));
            alert("Deleted!");
        }
    };
</script>
</body>
</html>